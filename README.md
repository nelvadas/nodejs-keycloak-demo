# nodejs-keycloak-demo
Secure Nodejs API With Keycloack


## Start a keycloak server
docker run -e DB_VENDOR=H2 -e KEYCLOAK_USER=admin -e \
KEYCLOAK_PASSWORD=Admin1234 -p 8080:8080 --name keycloak-server -dit jboss/keycloak:8.0.2

[Keycloak tags are available here] (https://hub.docker.com/r/jboss/keycloak/tags)

### Create a realm
Create a realm with name MYREALM
### Create a client with confidential access
Create a client with user `appuser and password `appPassword`
Copy the secret key generated for this client  `076506a4-8b7a-45fb-95b5-3644a02b8971`

## Secure API With Keycloack

### Get Access token


    ```curl \
      -d "client_id=hellocanalous" \
      -d "client_secret=076506a4-8b7a-45fb-95b5-3644a02b8971" \
      -d "username=appuser" \
      -d "password=appPassword" \
      -d "grant_type=password" \
      "http://localhost:8080/auth/realms/MYREALM/protocol/openid-connect/token"
```

"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICItaHZNa0lBU1JFNzBTUXgyelNrWnpXaEstQnktblZsNHRWWU5idHhIOVFRIn0.eyJqdGkiOiJlOTdjNTgyMC01NTIyLTQ3ZjgtOGExMy1iNTA3ZGIwYTdmOTciLCJleHAiOjE1ODIwNjI2NTgsIm5iZiI6MCwiaWF0IjoxNTgyMDYyMzU4LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvQ2FuYWxvdXNBUEkiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiMjJjMzQ1N2EtODg3Yy00N2UyLWJkYTEtNTBmNDdjOWNkNWIzIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiaGVsbG9jYW5hbG91cyIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6IjgyYmE5MjcxLTQwOTgtNDRkZC05ZTE5LWY3Yzg1MmJjZDIyNSIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cDovL2xvY2FsaG9zdDo4MDAwIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJjYW5hbG91c2ZlIn0.fPjpvJNwN4YCsbhQVL_AqY0GGtXKP8sg6IdlqHhpe-ok0MrrJpgQ3k1EB_aY-huK9qEGUp8aOZJSiEmJvlGyW5KT9HUvMLcElzd4iQBCKUOy3S8Dmteu4lAYkTGLkwfN1Vrk4yqGppVZuT2JXPuh3211KcEVcr4j5ygImzGRs6xXPCXbS6dWZnUaRiHDK9WIdlCPjpafCXP-Wlxb-PlgxMv5FvLbhLKTLfpi7cHTZEnUnfsEQt-YLhAxzgBG4eK4zfdKEti01Zx-ibkHhIyNgX7D6lx04JS5gA5JtRljRKzy-mE8BEP8seIaR7uxnDcq7grb_gNZcNCHg3Vl7S-XIA","expires_in":300,"refresh_expires_in":1800,"refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIyYjYwYzljYi05OGEwLTQ3MDQtOGVmZS0yZTc5NjAxMjYxOWIifQ.eyJqdGkiOiJhYTlhMzZjMy1kMmM4LTQwYWItOTAxZi0wZmIwZTEyZDIxODUiLCJleHAiOjE1ODIwNjQxNTgsIm5iZiI6MCwiaWF0IjoxNTgyMDYyMzU4LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvQ2FuYWxvdXNBUEkiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvQ2FuYWxvdXNBUEkiLCJzdWIiOiIyMmMzNDU3YS04ODdjLTQ3ZTItYmRhMS01MGY0N2M5Y2Q1YjMiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiaGVsbG9jYW5hbG91cyIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6IjgyYmE5MjcxLTQwOTgtNDRkZC05ZTE5LWY3Yzg1MmJjZDIyNSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJwcm9maWxlIGVtYWlsIn0.CeOAgEVCfrc88LNQWkyssvi181hVzLa7-pzyNNusfDc","token_type":"bearer","not-before-policy":0,"session_state":"82ba



## Make a call
copy the access token and pass it as a Brearer Authorization token
```
curl -X GET \
  http://localhost:8000/api/secure \
  -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICItaHZNa0lBU1JFNzBTUXgyelNrWnpXaEstQnktblZsNHRWWU5idHhIOVFRIn0.eyJqdGkiOiJhNGY4MzFiNi1hODkzLTQwYTItOTM0Yi1iODI5MDFmNDQ5NTgiLCJleHAiOjE1ODIxMDgyNjcsIm5iZiI6MCwiaWF0IjoxNTgyMTA3OTY3LCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvQ2FuYWxvdXNBUEkiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiMjJjMzQ1N2EtODg3Yy00N2UyLWJkYTEtNTBmNDdjOWNkNWIzIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiaGVsbG9jYW5hbG91cyIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6ImVkYmE2MjY0LTk3ZWItNDVkNS1hYTNkLWFjMDVhZGE3OTYzMCIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cDovL2xvY2FsaG9zdDo4MDAwIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiaGVsbG9jYW5hbG91cyI6eyJyb2xlcyI6WyJ1c2VyIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6ImNhbmFsb3VzZmUifQ.guYCD0f8AiR1RoEDzw2YIfw2QwInjX2KkyVWVTkUpNx_X_6s7L0B2KFYZR2Ngu0TxZqLmtK3gtCOMSf-YYQTT5haWlnJBirAkFZUbDNqurr2AQTgK7XL8DXpSvqAapXN-1hKf8M0JErrDTURe0XWbuVBnqtztiyMUwN083FjrHN4doGhDjBD5MJob_xoUIZSEmYL5zdi9rzDz0luzSDNiT7dNCYedhx-UEfkldunZbzINyAv9QRpSpbdxGq2yaWheBX6-ZF8zkAEDMDMQunvUauIWzzRuQ-LRXnAWFq21WDvDk7idHlBYZVLZNBp51bgjz2ni0L6j0uaWN3G7YLm6w'

{"project":"Hello","release":"1.0.0","description":" API Hello world  "}
```
